#!/bin/bash

## ðŸ’» LISELOT'S MACOS SETUP ðŸ’» ###

#version 1#
_____

### Must do first ###

# Ask for the administrator password upfront.
sudo -v

# Install Xcode
xcode-select --install

# Keep-alive: update existing `sudo` time stamp until `.macos` has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

# Install ðŸº Homebrew"
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

# Allow third party software
sudo spctl --master-disable

# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

echo "ðŸš€ Starting setup"

# Install Oh-My-Zsh
sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"

# Change login shell to zsh
chsh -s /bin/zsh

# Add /usr/local/bin/sbin to Default Path
install_paths () {
Â  if ! grep -Fq "/usr/local/sbin" /etc/paths; then
Â  Â  sudo sed -i "" -e "/\/usr\/sbin/{x;s/$/\/usr\/local\/sbin/;G;}" /etc/paths
Â  fi
}

# Look for developer tools (needed for Homebrew)
xcode-select -p
if [ $? -eq 0 ]; then
Â  Â  echo "Found XCode Tools"
else
Â  Â  echo "Installing XCode Tools"

Â  Â  xcode-select --install
fi

# Flags
set -e # Global exit on error flag
set -x # Higher verbosity for easier debug
set -o pipefail # Exit on pipe error

# Add Homebrew Packages to Brewfile
install_brewfile_brew_pkgs () {
Â  printf "%s\n" "${_pkgs}" | \
Â  while IFS="$(printf '\t')" read pkg; do
Â  Â  # printf 'brew "%s", args: [ "force-bottle" ]\n' "${pkg}" >> "${BREWFILE}"
Â  Â  printf 'brew "%s"\n' "${pkg}" >> "${BREWFILE}"
Â  done
Â  printf "\n" >> "${BREWFILE}"
}

# Install Git
brew install git&
which git
# Download the .gitconfig file to your home directory:
cd ~
curl -O https://raw.githubusercontent.com/nicolashery/mac-dev-setup/master/.gitconfig

# Install Node.js with nodenv
install_node_sw () {
Â  if which nodenv > /dev/null; then
Â  Â  NODENV_ROOT="/usr/local/node" && export NODENV_ROOT

Â  Â  sudo mkdir -p "$NODENV_ROOT"
Â  Â  sudo chown -R "$(whoami):admin" "$NODENV_ROOT"

Â  Â  p "Installing Node.js with nodenv"
Â  Â  git clone https://github.com/nodenv/node-build-update-defs.git \
Â  Â  Â  "$(nodenv root)"/plugins/node-build-update-defs
Â  Â  nodenv update-version-defs > /dev/null

Â  Â  nodenv install --skip-existing 8.7.0
Â  Â  nodenv global 8.7.0

Â  Â  grep -q "${NODENV_ROOT}" "/etc/paths" || \
Â  Â  sudo sed -i "" -e "1i\\
${NODENV_ROOT}/shims
" "/etc/paths"

Â  Â  init_paths
Â  Â  rehash
Â  fi

Â  T=$(printf '\t')

Â  printf "%s\n" "$_npm" | \
Â  while IFS="$T" read pkg; do
Â  Â  npm install --global "$pkg"
Â  done

Â  rehash
}

git config --global user.name "Liselot3";
git config --global user.email "sweetthunder33@gmail.com"

git config --global credential.helper osxkeychain

# Install Python with pyenv
install_python_sw () {
Â  if which pyenv > /dev/null; then
Â  Â  CFLAGS="-I$(brew --prefix openssl)/include" && export CFLAGS
Â  Â  LDFLAGS="-L$(brew --prefix openssl)/lib" && export LDFLAGS
Â  Â  PYENV_ROOT="/usr/local/python" && export PYENV_ROOT

Â  Â  sudo mkdir -p "$PYENV_ROOT"
Â  Â  sudo chown -R "$(whoami):admin" "$PYENV_ROOT"

Â  Â  p "Installing Python 2 with pyenv"
Â  Â  pyenv install --skip-existing 2.7.13
Â  Â  p "Installing Python 3 with pyenv"
Â  Â  pyenv install --skip-existing 3.6.2
Â  Â  pyenv global 2.7.13

Â  Â  grep -q "${PYENV_ROOT}" "/etc/paths" || \
Â  Â  sudo sed -i "" -e "1i\\
${PYENV_ROOT}/shims
" "/etc/paths"

Â  Â  init_paths
Â  Â  rehash

Â  Â  pip install --upgrade "pip" "setuptools"

Â  Â  # Reference: https://github.com/mdhiggins/sickbeard_mp4_automator
Â  Â  pip install --upgrade "babelfish" "guessit<2" "qtfaststart" "requests" "stevedore==1.19.1" "subliminal<2"
Â  Â  pip install --upgrade "requests-cache" "requests[security]"

Â  Â  # Reference: https://github.com/pixelb/crudini
Â  Â  pip install --upgrade "crudini"
Â  fi
}

# Install Ruby with rbenv
install_ruby_sw () {
Â  if which rbenv > /dev/null; then
Â  Â  RBENV_ROOT="/usr/local/ruby" && export RBENV_ROOT

Â  Â  sudo mkdir -p "$RBENV_ROOT"
Â  Â  sudo chown -R "$(whoami):admin" "$RBENV_ROOT"

Â  Â  p "Installing Ruby with rbenv"
Â  Â  rbenv install --skip-existing 2.4.2
Â  Â  rbenv global 2.4.2

Â  Â  grep -q "${RBENV_ROOT}" "/etc/paths" || \
Â  Â  sudo sed -i "" -e "1i\\
${RBENV_ROOT}/shims
" "/etc/paths"

Â  Â  init_paths
Â  Â  rehash

Â  Â  printf "%s\n" \
Â  Â  Â  "gem: --no-document" | \
Â  Â  tee "${HOME}/.gemrc" > /dev/null

Â  Â  gem update --system > /dev/null

Â  Â  trash "$(which rdoc)"
Â  Â  trash "$(which ri)"
Â  Â  gem update

Â  Â  gem install bundler
Â  fi
}

# Add Homebrew Taps to Brewfile
install_brewfile_taps () {
Â  printf "%s\n" "${_taps}" | \
Â  while IFS="$(printf '\t')" read tap; do
Â  Â  printf 'tap "%s"\n' "${tap}" >> "${BREWFILE}"
Â  done
Â  printf "\n" >> "${BREWFILE}"
}

# Add Caskroom Options to Brewfile
install_brewfile_cask_args () {
Â  printf 'cask_args \' >> "${BREWFILE}"
Â  printf "%s\n" "${_args}" | \
Â  while IFS="$(printf '\t')" read arg dir; do
Â  Â  printf '\nÂ  %s: "%s",' "${arg}" "${dir}" >> "${BREWFILE}"
Â  done
Â  sed -i "" -e '$ s/,/\
/' "${BREWFILE}"
}

# Add Homebrew Casks to Brewfile
install_brewfile_cask_pkgs () {
Â  printf "%s\n" "${_casks}" | \
Â  while IFS="$(printf '\t')" read cask; do
Â  Â  printf 'cask "%s"\n' "${cask}" >> "${BREWFILE}"
Â  done
Â  printf "\n" >> "${BREWFILE}"
}

# Add App Store Packages to Brewfile
install_brewfile_mas_apps () {
Â  open "/Applications/App Store.app"
Â  run "Sign in to the App Store with your Apple ID" "Cancel" "OK"

Â  MASDIR="$(getconf DARWIN_USER_CACHE_DIR)com.apple.appstore"
Â  sudo chown -R "$(whoami)" "${MASDIR}"
Â  rsync -a --delay-updates \
Â  Â  "${CACHES}/mas/" "${MASDIR}/"

Â  printf "%s\n" "${_mas}" | \
Â  while IFS="$(printf '\t')" read app id; do
Â  Â  printf 'mas "%s", id: %s\n' "${app}" "${id}" >> "${BREWFILE}"
Â  done
}

### Install packages
brew install npm
brew install xcodegen
brew install git
brew install node
brew install ruby
brew install rsync
brew install openssl
brew install trash
brew install terminal-notifier
brew install zsh
brew install zsh-syntax-highlighting
brew install environments
brew install python3 # Python version 3.7, preinstalled is 2.7
brew install pandoc # Markup to Word/Open office converter needed by Typora
brew install bash # newest bash version. System's default is 3
brew install coreutils # GNU File, Shell, and Text utilities
brew install dmg2img # Utilities for converting macOS DMG images
brew install wget # Internet file retriever
brew install mint # Dependency mng, installs & runs Swift command-line tool packages

#Unused
#brew install vapor/tap/vapor # backend framework

echo "ðŸº Updating homebrew..."
brew update

#Install Ruby gems
GEMS=(
Â  Â  xcpretty
Â  Â  bundler
)

echo "ðŸ’Ž Installing Ruby gems"
sudo gem install ${GEMS[@]} -N


echo "ðŸ§¼ Cleaning up..."
brew cleanup -s


### Install non-AppStore apps
nonAppStoreApps=(
#Browsers
Â  Â  google-chrome
#Developer
Â  Â  visual-studio-code # Modern code editor with community-driven plugins
Â  Â  iterm2 # Alternative terminal
Â  Â  sublime-text # Cross-platform code editor with own high performance rendering engine
Â  Â  pycharm
Â  Â  visual-studio-code
Â  Â  visual-studio
Â  Â  appcode
Â  Â  haskell-for-mac
Â  Â  atom
Â  Â  brackets
Â  Â  sublime-text
Â  Â  macdown
Â  Â  little-snitch
Â  Â  github
Â  Â  gitfinder
Â  Â  clipy
Â  Â  iterm3
Â  Â  google-cloud-sdk
#HDD
Â  Â  drivedx # SMART status and HDD health tool
Â  Â  paragon-ntfs # Support for NTFS file system
#Video & Audio
Â  Â  vlc # Most popular cross-platform video watching app
Â  Â  handbrake # Video Transcoder
Â  Â  spotify
#Notes/Education
Â  Â  evernote
Â  Â  microsoft-teams
#Graphics
Â  Â  gimp # Graphics editor
#Cloud Storage
Â  Â  dropbox
Â  Â  google-backup-and-sync
#Social
Â  Â  whatsapp
#Utilities
Â  Â  wavebox
Â  Â  Dashlane # Password Manager
Â  Â  find-empty-folders
Â  Â  bettertouchtool # Custom gestures for touchpad and touchbar & reverse scrolling setting
#Other
Â  Â  grammarly
Â  Â  evernote
Â  Â  transmission # Torrents client
Â  Â  calibre # Mobi/epub e-book converter
Â  Â  anki # App for learning with flashcard
#UnusedÂ  
Â  Â  # microsoft-office
Â  Â  # skype # Communicator
Â  Â  # virtualbox # Virtual Machine
Â  Â  # virtualbox-extension-pack # Extensions for virtualbox such as display resolution and USB
Â  Â  # docker # App to make containers for environments 
Â  Â  # zoomus # Video conference App
)

echo "Install non-AppStore apps"
brew cask install ${nonAppStoreApps[@]}

# Install AppStore CLI installer
brew install mas

### Install AppStore apps
appStoreApps=(
Â  Â  497799835 # Xcode (Apple IDE)
Â  Â  462054704 # Microsoft Word (Documents editor)
Â  Â  462058435 # Microsoft Excel (Spreadsheets editor)
Â  Â  462062816 # Microsoft PowerPoint (Presentations editor)
Â  Â  985367838 # Microsoft Outlook (Email client)
Â  Â  1388020431 # DevCleaner for Xcode (deletes old Xcode files in ~/Library/Developer folder)
#Unused
Â  Â  # 425424353 # The Unarchiver (Archives extractor)
Â  Â  # 405399194 # Kindle (Mobi file format reader)
Â  Â  # 985367838 # Microsoft Outlook (Email client)
Â  Â  # 1278508951 # Trello (Project management tool)
Â  Â  # 430798174 # HazeOver (App that dims unfocused windows)
Â  Â  # 425955336 # Skitch (App for marking pictures)
Â  Â  # 411643860 # Daisy Disk (App for recovering disk space)
)

echo "Install AppStore apps"
mas install ${appStoreApps[@]}

# python
sudo easy_install pip;
pip install --upgrade;

#Link System Utilities to Applications
install_links () {
Â  printf "%s\n" "${_links}" | \
Â  while IFS="$(printf '\t')" read link; do
Â  Â  find "${link}" -maxdepth 1 -name "*.app" -type d -print0 2> /dev/null | \
Â  Â  xargs -0 -I {} -L 1 ln -s "{}" "/Applications" 2> /dev/null
Â  done
}

# Install terminal colors for Bash (choose between light and dark theme)
echo -e "export CLICOLOR=1\n#light theme\nexport LSCOLORS=ExFxBxDxCxegedabagacad\n#dark theme\n#export LSCOLORS=GxFxCxDxBxegedabagaced" >> ~/.bash_profile

# Fix Catalina bug with "Insecure completion-dependent directories detected"
compaudit | xargs chmod g-w,o-w

# Install terminal colors for zsh (light theme)
# Use this generator to translate BSD colors and Linux colors: https://geoff.greer.fm/lscolors/
echo -e 'export LSCOLORS="ExFxBxDxCxegedabagacad"' >> ~/.zshrc
echo -e 'export LS_COLORS="di=1;34:ln=1;35:so=1;31:pi=1;33:ex=1;32:bd=34;46:cd=34;43:su=30;41:sg=30;46:tw=30;42:ow=30;43"' >> ~/.zshrc
echo -e "zstyle ':completion:*:default' list-colors \${(s.:.)LS_COLORS}" >> ~/.zshrc

# Uncomment en_US.UTF-8 locale for console, making them undependable from macOS locale settings
sed -i -e 's/# export LANG=en_US.UTF-8/export LANG=en_US.UTF-8/g' ~/.zshrc

# Copy SF Mono font (available only in Xcode and Terminal.app) to the system
cp -R /System/Applications/Utilities/Terminal.app/Contents/Resources/Fonts/. /Library/Fonts/

# Remove ALL icons (except Finder) from dock
echo "Removing all icons (except Finder) from the dockâ€¦"
defaults write com.apple.dock persistent-apps -array

# Install developer friendly quick look plugins; see https://github.com/sindresorhus/quick-look-plugins
brew cask install qlcolorcode qlstephen qlmarkdown quicklook-json qlprettypatch quicklook-csv betterzip qlimagesize webpquicklook suspicious-package quicklookase qlvideo

# List of dock icons
dockIcons=(
Â  Â  /System/Applications/Utilities/Terminal.app
Â  Â  /System/Applications/Mail.app
Â  Â  /System/Applications/Messages.app
Â  Â  /Applications/Safari.ap
Â  Â  "/Applications/Visual Studio Code.app"
Â  Â  /Applications/Xcode.app
)

# Adding icons
for icon in "${dockIcons[@]}"
do
Â  Â  echo "Adding $icon to the dockâ€¦"
Â  Â  defaults write com.apple.dock persistent-apps -array-add 
Â  Â  "<dict><key>tile-data</key><dict><key>file-data</key><dict><key>_CFURLString</key><string>$icon</string><key>_CFURLStringType</key><integer>0</integer></dict></dict></dict>"
done

echo "Setting up dock sizeâ€¦"
defaults write com.apple.dock tilesize -int 40

echo "Restarting dockâ€¦"
killall Dock

# As we installed homebrew before xcode, we need to switch to Xcode Command Line Tools
sudo xcode-select -s /Applications/Xcode.app/Contents/Developer

# List of mint packages
mintPackages=(
Â  Â  MakeAWishFoundation/SwiftyMocky # Library to autogenerate mocks
)

mint install ${mintPackages[@]}

# install CocoaPods dependency manager for iOS apps
sudo gem install cocoapods

# install CocoaPods Keys plugin
sudo gem install cocoapods-keys

### Set Preferences ###

# Xcode won't ask for password with every build
sudo DevToolsSecurity -enable

# Create symlinks between home folder & iCloud folders
#WARNING This command uses "~" sign, so don't just copy paste it using ZSH. Use bash for this one!
ln -s ~/ ~/Library/Mobile\ Documents/com~apple~CloudDocs/$(whoami)\ home\ symlink
ln -s ~/Library/Mobile\ Documents/com~apple~CloudDocs/Documents ~/Documents\ symlink
ln -s ~/Desktop ~/Desktop\ symlink

# Make a Developer folder synchronise
mkdir ~/Library/Mobile\ Documents/com~apple~CloudDocs/Developer
ln -s ~/Library/Mobile\ Documents/com~apple~CloudDocs/Developer ~/Developer\ symlink

# Show debug menu on AppStore
sudo defaults write com.apple.appstore ShowDebugMenu -bool true

# Show debug menu on contacts
sudo defaults write com.apple.addressbook ABShowDebugMenu -bool true

# Remove Apple Remote Desktop Settings
sudo rm -rf /var/db/RemoteManagement ; \
sudo defaults delete /Library/Preferences/com.apple.RemoteDesktop.plist ; \
defaults delete ~/Library/Preferences/com.apple.RemoteDesktop.plist ; \
sudo rm -r /Library/Application\ Support/Apple/Remote\ Desktop/ ; \
rm -r ~/Library/Application\ Support/Remote\ Desktop/ ; \
rm -r ~/Library/Containers/com.apple.RemoteDesktop

# Use Plain Text Mode as Default
defaults write com.apple.TextEdit RichText -int 0

# Remove All Unavailable Simulators on Xcode
xcrun simctl delete unavailable

#brew
brew install emacs --with-cocoa;
brew linkapps emacs

# Link all applications
mkdir $HOME/Applications /
brew linkapps

#DOCK
#Auto Rearrange Spaces Based on Most Recent Use
defaults write com.apple.dock mru-spaces -bool true && \
killall Dock
# Lock the Dock Size
defaults write com.apple.Dock size-immutable -bool yes && \
killall Dock

# Convert File to HTML
# Supported formats are plain text, rich text (rtf) and Microsoft Word (doc/docx).
textutil -convert html file.ext

# Activate And Restart the ARD Agent and Helper
sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -activate -restart -agent -console

# Deactivate and Stop the Remote Management Service
sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -deactivate -stop

# Remove Apple Remote Desktop Settings
sudo rm -rf /var/db/RemoteManagement ; \
sudo defaults delete /Library/Preferences/com.apple.RemoteDesktop.plist ; \
defaults delete ~/Library/Preferences/com.apple.RemoteDesktop.plist ; \
sudo rm -r /Library/Application\ Support/Apple/Remote\ Desktop/ ; \
rm -r ~/Library/Application\ Support/Remote\ Desktop/ ; \
rm -r ~/Library/Containers/com.apple.RemoteDesktop


##Visual Studio Code##
# Enable VSCode key repeat
defaults write com.microsoft.VSCode ApplePressAndHoldEnabled -bool false

# Remove All Unavailable Simulators
xcrun simctl delete unavailable;
sudo diskutil repairPermissions /
sudo systemsetup -setstartupdisk /System/Library/CoreServices

#clear all ACLs
sudo chmod -RN /

# Disable guest user
sudo dscl . -delete /Users/Guest;
sudo security delete-generic-password -a Guest -s com.apple.loginwindow.guest-account -D "application password" /Library/Keychains/System.keychain;
sudo defaults write /Library/Preferences/com.apple.loginwindow GuestEnabled -bool FALSE

# Disable compatibility check
sudo nvram boot-args="-no_compat_check"

###############################################################################
# FinderÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  #
###############################################################################

# Show All File Extensions
sudo defaults write -g AppleShowAllExtensions -bool true
# Show Full Path in Finder Title
sudo defaults write com.apple.finder _FXShowPosixPathInTitle -bool true
# Show "Quit Finder" Menu Item
sudo defaults write com.apple.finder QuitMenuItem -bool true && \
killall Finder
# Expand Save Panel by Default
sudo defaults write -g NSNavPanelExpandedStateForSaveMode -bool true && \
sudo defaults write -g NSNavPanelExpandedStateForSaveMode2 -bool true
# Show path bar
sudo defaults write com.apple.finder ShowPathbar -bool true
# Show status bar
sudo defaults write com.apple.finder ShowStatusBar -bool true
# Save to Disk by Default, not iCloud
sudo defaults write -g NSDocumentSaveNewDocumentsToCloud -bool false
# Set Sidebar icon size to medium
sudo defaults write -g NSTableViewDefaultSizeMode -int 2
# Disable Creation of Metadata Files on USB Volumes ( .DS_Store )
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true
# Change Working Directory to Finder Path
cd "$(osascript -e 'tell app "Finder" to POSIX path of (insertion location as alias)')
# Keep folders on top when sorting by name
sudo defaults write com.apple.finder _FXSortFoldersFirst -bool true"
# Allow quitting via âŒ˜ + Q; doing so will also hide desktop icons
sudo defaults write com.apple.finder QuitMenuItem -bool true
# When performing a search, search the current folder by default
sudo defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"
# Show the /Volumes folder
sudo chflags nohidden /Volumes
# Expand the following File Info panes:
# â€œGeneralâ€, â€œOpen withâ€, and â€œSharing & Permissionsâ€
sudo defaults write com.apple.finder FXInfoPanesExpanded -dict \
Â  Â  General -bool true \
Â  Â  OpenWith -bool true \
Â  Â  Privileges -bool true

# Automatic Restart on System Freeze
sudo systemsetup -setrestartfreeze on

# Menu bar: show remaining batteryÂ  percentage
defaults write com.apple.menuextra.battery ShowPercent -string "YES"

# Configure Guest Users
Â  sudo sysadminctl -guestAccount off

# Configure ðŸ›  system
defaults write -g InitialKeyRepeat -int 15
defaults write com.apple.AppleMultitouchTrackpad Clicking -bool true
defaults write -g KeyRepeat -int 2

# Eliminate prompts for passwords
printf "%s\n" "%wheel ALL=(ALL) NOPASSWD: ALL" | \
sudo tee "/etc/sudoers.d/wheel" > /dev/null && \
sudo dscl /Local/Default append /Groups/wheel GroupMembership "$(whoami)"

# Set Defaults for Sleep
sudo pmset -a sleep 0
sudo pmset -a disksleep 0

# App settings
set -eÂ  Â  Â  Â  Â  # Exit on error
set -o pipefail # Exit on pipe error
set -xÂ  Â  Â  Â  Â  # Enable verbosity

# Disable recently played videos
sudo defaults write org.videolan.vlc NSRecentDocumentsLimit 0;
sudo defaults write org.videolan.vlc.LSSharedFileList RecentDocuments -dict-add MaxAmount 0

# Set Software Update Check Interval (check daily instead of weekly)
sudo defaults write com.apple.SoftwareUpdate ScheduleFrequency -int 1

# Set the dark style
sudo defaults write NSGlobalDomain AppleInterfaceStyle -string 'Dark'

# Menu bar: show remaining batteryÂ  percentage
sudo defaults write com.apple.menuextra.battery ShowPercent -string "YES"

# Disable the â€œAre you sure you want to open this application?â€ dialog
sudo defaults write com.apple.LaunchServices LSQuarantine -bool false

# Disable the crash reporter
sudo defaults write com.apple.CrashReporter DialogType -string "none"

# Disable Notification Center and remove the menu bar icon
launchctl unload -w /System/Library/LaunchAgents/com.apple.notificationcenterui.plist 2> /dev/null

# Enable full keyboard access for all controls (e.g. enable Tab in modal dialogs)
defaults write NSGlobalDomain AppleKeyboardUIMode -int 3

# Disable machine sleep while charging
sudo pmset -c sleep 0

# Save screenshots to the desktop
defaults write com.apple.screencapture location -string "${HOME}/Desktop"

# Save screenshots in PNG format (other options: BMP, GIF, JPG, PDF, TIFF)
defaults write com.apple.screencapture type -string "png"

# Remove Gatekeeper Exception
spctl --remove /path/to/Application.app

# Manage Gatekeeper
# Especially helpful with the annoying macOS 10.15 (Catalina) system popup blocking execution of non-signed apps.
# Status
spctl --status
# Enable (Default)
sudo spctl --master-enable
# Disable
sudo spctl --master-disable

# Donâ€™t display the annoying prompt when quitting iTerm
sudo defaults write com.googlecode.iterm2 PromptOnQuit -bool false

###############################################################################
# TextEditÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  #
###############################################################################

# Use plain text mode for new TextEdit documents
sudo defaults write com.apple.TextEdit RichText -int 0

# Open and save files as UTF-8 in TextEdit
sudo defaults write com.apple.TextEdit PlainTextEncoding -int 4;
sudo defaults write com.apple.TextEdit PlainTextEncodingForWrite -int 4


###############################################################################
# Mac App StoreÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  #
###############################################################################

# Enable the automatic update check
defaults write com.apple.SoftwareUpdate AutomaticCheckEnabled -bool true

# Check for software updates daily, not just once per week
defaults write com.apple.SoftwareUpdate ScheduleFrequency -int 1

# Download newly available updates in background
defaults write com.apple.SoftwareUpdate AutomaticDownload -int 1

# Install System data files & security updates
defaults write com.apple.SoftwareUpdate CriticalUpdateInstall -int 1

# Turn on app auto-update
defaults write com.apple.commerce AutoUpdate -bool true

# Allow the App Store to reboot machine on macOS updates
defaults write com.apple.commerce AutoUpdateRestartRequired -bool true


### CONFIGURE ###

# Define Function config
config () {
Â  config_admin_req
Â  config_bbedit
Â  config_desktop
Â  config_emacs
Â  config_environment
Â  config_istatmenus
Â  config_openssl
Â  config_sysprefs
Â  config_zsh
Â  config_guest
Â  
Â  which custom
}

# Define Function config_defaults
config_defaults () {
Â  printf "%s\n" "${1}" | \
Â  while IFS="$(printf '\t')" read domain key type value host; do
Â  Â  ${2} defaults ${host} write ${domain} "${key}" ${type} "${value}"
Â  done
}

# Define Function config_plist
T="$(printf '\t')"

config_plist () {
Â  printf "%s\n" "$1" | \
Â  while IFS="$T" read command entry type value; do
Â  Â  case "$value" in
Â  Â  Â  (\$*)
Â  Â  Â  Â  $4 /usr/libexec/PlistBuddy "$2" \
Â  Â  Â  Â  Â  -c "$command '${3}${entry}' $type '$(eval echo \"$value\")'" 2> /dev/null ;;
Â  Â  Â  (*)
Â  Â  Â  Â  $4 /usr/libexec/PlistBuddy "$2" \
Â  Â  Â  Â  Â  -c "$command '${3}${entry}' $type '$value'" 2> /dev/null ;;
Â  Â  esac
Â  done
}

# Define Function config_launchd
config_launchd () {
Â  test -d "$(dirname $1)" || \
Â  Â  $3 mkdir -p "$(dirname $1)"

Â  test -f "$1" && \
Â  Â  $3 launchctl unload "$1" && \
Â  Â  $3 rm -f "$1"

Â  config_plist "$2" "$1" "$4" "$3" && \
Â  Â  $3 plutil -convert xml1 "$1" && \
Â  Â  $3 launchctl load "$1"
}

# Configure Desktop Picture
config_desktop () {
Â  sudo rm -f "/Library/Caches/com.apple.desktop.admin.png"

Â  base64 -D << EOF > "/Library/Desktop Pictures/Solid Colors/Solid Black.png"
<<black.png.b64>>
EOF
}

# Configure Environment Variables
config_environment () {
Â  sudo tee "/etc/environment.sh" << 'EOF' > /dev/null
<<environment.sh>>
EOF
Â  sudo chmod a+x "/etc/environment.sh"
Â  rehash

Â  la="/Library/LaunchAgents/environment.user"
Â  ld="/Library/LaunchDaemons/environment"

Â  sudo mkdir -p "$(dirname $la)" "$(dirname $ld)"
Â  sudo launchctl unload "${la}.plist" "${ld}.plist" 2> /dev/null
Â  sudo rm -f "${la}.plist" "${ld}.plist"

Â  config_defaults "$_environment_defaults" "sudo"
Â  sudo plutil -convert xml1 "${la}.plist" "${ld}.plist"
Â  sudo launchctl load "${la}.plist" "${ld}.plist" 2> /dev/null
}
/etc/environment.sh

#!/bin/sh

set -e

if test -x /usr/libexec/path_helper; then
Â  export PATH=""
Â  eval `/usr/libexec/path_helper -s`
Â  launchctl setenv PATH $PATH
fi

osascript -e 'tell app "Dock" to quit'

# Configure OpenSSL
# Create intentionally invalid certificate for use w/DNS-based ad blocker, e.g. https://pi-hole.net

config_openssl () {
Â  _default="/etc/letsencrypt/live/default"
Â  test -d "$_default" || mkdir -p "$_default"

Â  cat << EOF > "${_default}/default.cnf"
<<openssl.cnf>>
EOF

Â  openssl req -days 1 -new -newkey rsa -x509 \
Â  Â  -config "${_default}/default.cnf" \
Â  Â  -out "${_default}/default.crt"

Â  cat << EOF > "/usr/local/etc/nginx/servers/default.conf"
<<default.conf>>
EOF
}
/etc/letsencrypt/live/default/default.cnf
[ req ]
default_bits = 4096
default_keyfile = ${_default}/default.key
default_md = sha256
distinguished_name = dn
encrypt_key = no
prompt = no
utf8 = yes
x509_extensions = v3_ca

[ dn ]
CN = *

[ v3_ca ]
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid:always,issuer
basicConstraints = CA:true
/usr/local/etc/nginx/servers/default.conf
server {
Â  server_name .$(hostname -f | cut -d. -f2-);

Â  listen 80;
Â  listen [::]:80;

Â  return 301 https://\$host\$request_uri;
}

server {
Â  listen 80 default_server;
Â  listen [::]:80 default_server;

Â  listen 443 default_server ssl http2;
Â  listen [::]:443 default_server ssl http2;

Â  ssl_certificate ${_default}/default.crt;
Â  ssl_certificate_key ${_default}/default.key;

Â  ssl_ciphers NULL;

Â  return 204;
}

# Configure energy saver
config_energy () {
Â  printf "%s\n" "${_energy}" | \
Â  while IFS="$(printf '\t')" read flag setting value; do
Â  Â  sudo pmset $flag ${setting} ${value}
Â  done
}

# Configure git
# On a specific repository
git config user.email "sweetthunder33@gmail.com"
git config user.name "Liselot3"
git config user.signingkey <KeyIdVALUE>
git config commit.gpgsign true

# or globally
git config --global commit.gpgsign true
git config --global user.signingkey <KeyIdVALUE>

# Configure Z-Shell
config_zsh () {
Â  grep -q "$(which zsh)" /etc/shells ||
Â  print "$(which zsh)\n" | \
Â  sudo tee -a /etc/shells > /dev/null

Â  case "$SHELL" in
Â  Â  ($(which zsh)) ;;
Â  Â  (*)
Â  Â  Â  chsh -s "$(which zsh)"
Â  Â  Â  sudo chsh -s $(which zsh) ;;
Â  esac

Â  sudo tee -a /etc/zshenv << 'EOF' > /dev/null
<<etc-zshenv>>
EOF
Â  sudo chmod +x "/etc/zshenv"
Â  . "/etc/zshenv"

Â  sudo tee /etc/zshrc << 'EOF' > /dev/null
<<etc-zshrc>>
EOF
Â  sudo chmod +x "/etc/zshrc"
Â  . "/etc/zshrc"
}

#Â  Set Permissions on Install Destinations
init_perms () {
Â  printf "%s\n" "${_dest}" | \
Â  while IFS="$(printf '\t')" read d; do
Â  Â  test -d "${d}" || sudo mkdir -p "${d}"
Â  Â  sudo chgrp -R admin "${d}"
Â  Â  sudo chmod -R g+w "${d}"
Â  done
}

# Mark Applications Requiring Administrator Account
config_admin_req () {
Â  printf "%s\n" "${_admin_req}" | \
Â  while IFS="$(printf '\t')" read app; do
Â  Â  sudo tag -a "Red, admin" "/Applications/${app}"
Â  done
}

# Reinstate sudo Password
config_rm_sudoers () {
Â  sudo -- sh -c \
Â  Â  "rm -f /etc/sudoers.d/wheel; dscl /Local/Default -delete /Groups/wheel GroupMembership $(whoami)"

Â  /usr/bin/read -n 1 -p "Press any key to continue.
" -s
Â  if run "Log Out Then Log Back In?" "Cancel" "Log Out"; then
Â  Â  osascript -e 'tell app "loginwindow" to Â«event aevtrlgoÂ»'
Â  fi
}


# Customize Home
custom_githome () {
Â  git -C "${HOME}" init

Â  test -f "${CACHES}/dbx/.zshenv" && \
Â  Â  mkdir -p "${ZDOTDIR:-$HOME}" && \
Â  Â  cp "${CACHES}/dbx/.zshenv" "${ZDOTDIR:-$HOME}" && \
Â  Â  . "${ZDOTDIR:-$HOME}/.zshenv"

Â  a=$(ask "Existing Git Home Repository Path or URL" "Add Remote" "")
Â  if test -n "${a}"; then
Â  Â  git -C "${HOME}" remote add origin "${a}"
Â  Â  git -C "${HOME}" fetch origin master
Â  fi

Â  if run "Encrypt and commit changes to Git and push to GitHub, automatically?" "No" "Add AutoKeep"; then
Â  Â  curl --location --silent \
Â  Â  Â  "https://github.com/ptb/autokeep/raw/master/autokeep.command" | \
Â  Â  Â  . /dev/stdin 0

Â  Â  autokeep_remote
Â  Â  autokeep_push
Â  Â  autokeep_gitignore
Â  Â  autokeep_post_commit
Â  Â  autokeep_launchagent
Â  Â  autokeep_crypt

Â  Â  git reset --hard
Â  Â  git checkout -f -b master FETCH_HEAD
Â  fi

Â  chmod -R go= "${HOME}" > /dev/null 2>&1
}

# Customize Dropbox
test -d "/Applications/Dropbox.app" && \
Â  Â  open "/Applications/Dropbox.app"
Â  Â  
# Customize Default UTIs
custom_duti () {
Â  if test -x "/usr/local/bin/duti"; then
Â  Â  test -f "${HOME}/Library/Preferences/org.duti.plist" && \
Â  Â  Â  rm "${HOME}/Library/Preferences/org.duti.plist"

Â  Â  printf "%s\n" "${_duti}" | \
Â  Â  while IFS="$(printf '\t')" read id uti role; do
Â  Â  Â  defaults write org.duti DUTISettings -array-add \
Â  Â  Â  Â  "{
Â  Â  Â  Â  Â  DUTIBundleIdentifier = '$a';
Â  Â  Â  Â  Â  DUTIUniformTypeIdentifier = '$b';
Â  Â  Â  Â  Â  DUTIRole = '$c';
Â  Â  Â  Â  }"
Â  Â  done

Â  Â  duti "${HOME}/Library/Preferences/org.duti.plist" 2> /dev/null
Â  fi
}

##Finder##
custom_finder () {
Â  config_defaults "${_finder}"
Â  defaults write "com.apple.finder" "NSToolbar Configuration Browser" \
Â  Â  '{
Â  Â  Â  "TB Display Mode" = 2;
Â  Â  Â  "TB Item Identifiers" = (
Â  Â  Â  Â  "com.apple.finder.BACK",
Â  Â  Â  Â  "com.apple.finder.PATH",
Â  Â  Â  Â  "com.apple.finder.SWCH",
Â  Â  Â  Â  "com.apple.finder.ARNG",
Â  Â  Â  Â  "NSToolbarFlexibleSpaceItem",
Â  Â  Â  Â  "com.apple.finder.SRCH",
Â  Â  Â  Â  "com.apple.finder.ACTN"
Â  Â  Â  );
Â  Â  }'
}

# Customize SSH
custom_ssh () {
Â  if ! test -d "${HOME}/.ssh"; then
Â  Â  mkdir -m go= "${HOME}/.ssh"
Â  Â  e="$(ask 'New SSH Key: Email Address?' 'OK' '')"
Â  Â  ssh-keygen -t ed25519 -a 100 -C "$e"
Â  Â  cat << EOF > "${HOME}/.ssh/config"
Host *
Â  AddKeysToAgent yes
Â  IdentityFile ~/.ssh/id_ed25519
EOF
Â  Â  pbcopy < "${HOME}/.ssh/id_ed25519.pub"
Â  Â  open "https://github.com/settings/keys"
Â  fi
}

# Customize Clock
defaults -currentHost write com.apple.systemuiserver dontAutoLoad \
Â  Â  -array-add "/System/Library/CoreServices/Menu Extras/Clock.menu"
defaults write com.apple.menuextra.clock DateFormat \
Â  Â  -string "EEE MMM dÂ  h:mm:ss a"

#SSH
pbcopy < ~/.ssh/id_ed25519.pub
open https://github.com/settings/keys
terminal-notifier -title SSH key -messageÂ  "Copied SSH key to clipboard, add it to GitHub"

___

### Fonts ###

brew tap homebrew/fonts

### programming fonts
brew cask install font-fira-mono-for-powerline
brew cask install font-fira-code

### SourceCodePro + Powerline + Awesome Regular (for powerlevel 9k terminal icons)
cd ~/Library/Fonts && { curl -O 'https://github.com/Falkor/dotfiles/blob/master/fonts/SourceCodePro+Powerline+Awesome+Regular.ttf?raw=true' ; cd -; }

# Close any open System Preferences panes, to prevent them from overriding
# settings weâ€™re about to change
osascript -e 'tell application "System Preferences" to quit'

___

### Quicklook plugins ###

brew cask install qlcolorcode;
# syntax highlighting in preview
brew cask install qlstephen ;
# preview plaintext files without extension
brew cask install qlmarkdown;
# preview markdown files;
brew cask install quicklook-json;
# preview json files
brew cask install epubquicklook ;
# preview epubs, make nice icons
brew cask install quicklook-cs;

### End ###

# Restore Sane Shell
stty sane

# Clear DNS Cache
sudo dscacheutil -flushcache && \
sudo killall -HUP mDNSResponder

# Clear Font Cache for Current User
atsutil databases -removeUser && \
atsutil server -shutdown && \
atsutil server -ping

# Recursively Delete .DS_Store Files
find . -type f -name '*.DS_Store' -ls -delete

# Build Locate Database
sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.locate.plist

#Install macOS Updates
Â  sudo softwareupdate --install --all
Â  
# Update installed apps & clear caches
brew analytics off;
brew outdated;
brew update;
brew upgrade;
brew cask upgrade;
brew cleanup;
brew tap "homebrew/bundle";
rm -rf ~/Library/Caches/Homebrew

sudo purge

_____

### Extras ###

# Root User
# Enable
#dsenableroot

# Disable (Default)
#dsenableroot -d

## Safe Mode Boot##
# Status
#nvram boot-args

# Enable
#sudo nvram boot-args="-x"

# Disable (Default)
#sudo nvram boot-args=""

___

## GIT ## 

#Install git
arch -arm64 brew install git

#git version (output should beÂ /usr/local/bin/git)
which git

$ Basic git configuration $

#Define your Git user (they will get added to yourÂ .gitconfigÂ file)
git config --global user.name â€œLiselot3
git config --global user.email "sweetthunder33@gmail.com"

#Set up a globalÂ .gitignoreÂ file, located for instance in your home directory
curl -O https://raw.githubusercontent.com/nicolashery/mac-dev-setup/master/.gitignore
git config --global core.excludesfile ~/.git

$ Global Git Config $

git config â€” global push.default current;
git config â€” global core.excludesfile ~/.gitignore;
git config â€” global user.name â€œLiselot3â€;
git config â€” global user.email <sweetthunder33@gmail.com>;
git config â€” global color.branch auto;
git config â€” global color.diff auto;
git config â€” global color.interactive auto;
git config â€” global color.status auto;
git config â€” global alias.st status;
git config â€” global alias.ci commit;
git config â€” global alias.co checkout;
git config â€” global alias.br branch;

____

## FONTS ## 

echo "Installing fonts..."

brew tap homebrew/fonts

#Install programming fonts
arch -arm64 brew install font-fira-mono-for-powerline;
arch -arm64 brew install font-fira-code

### SourceCodePro + Powerline + Awesome Regular (for powerlevel 9k terminal icons)
cd ~/Library/Fonts && { curl -O 'https://github.com/Falkor/dotfiles/blob/master/fonts/SourceCodePro+Powerline+Awesome+Regular.ttf?raw=true' ; cd -; }

#Close any open System Preferences panes, to prevent them from overriding
osascript -e 'tell application "System Preferences" to quit'

#Performs consistency check on registered fonts
atsutil fonts -verify

# Copy SF Mono font (available only in Xcode and Terminal.app) to the system
cp -R /System/Applications/Utilities/Terminal.app/Contents/Resources/Fonts/. /Library/Fonts/
____

## NPM ##

#Install node
curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.31.4/install.sh | zsh;
nvm install node;
nvm use node

#Cleanup npm cache
npm cache clean --force

npm audit --audit-level=high;
npm install npm@latest -g --to upgrade;
npm install --cache /tmp/empty-cache --delete temperatry cache;
npm prune;
npm audit;
npm audit fix --force

#Determining which global packages need updating
npm outdated -g --depth=0

#Updating a single global package
npm update -g <package_name>

#Updating all globally-installed packages
npm update -g

#Get the current global location
npm config get prefix

#List global packages
npm list --global

#Show just the packages with their version number
npm list -g --depth=0;
npm cache clean --force

____

## RUBY ## 

#Install CocoaPods dependency manager for iOS apps
sudo gem install cocoapods

#Install CocoaPods Keys plugin
sudo gem install cocoapods-keys

____
